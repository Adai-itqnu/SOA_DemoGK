<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω s√°ch</title>
  <style>
    body { font-family: Arial; background: #f4f6f8; text-align: center; }
    form { margin: 20px auto; display: flex; justify-content: center; gap: 10px; }
    input { padding: 8px; }
    button { padding: 8px 12px; background: #007bff; color: white; border: none; cursor: pointer; }
    table { width: 90%; margin: 20px auto; border-collapse: collapse; background: #fff; }
    th, td { padding: 12px; border-bottom: 1px solid #ccc; }
    th { background: #007bff; color: white; }
  </style>
</head>
<body>
  <h2>üìñ Xin ch√†o Admin {{ admin }} - Qu·∫£n l√Ω s√°ch</h2>
  <a href="/logout">ƒêƒÉng xu·∫•t</a>

  <form onsubmit="return addBook(event)">
    <input id="id" type="number" placeholder="ID" required>
    <input id="title" type="text" placeholder="Ti√™u ƒë·ªÅ" required>
    <input id="author" type="text" placeholder="T√°c gi·∫£" required>
    <input id="category" type="text" placeholder="Th·ªÉ lo·∫°i">
    <input id="quantity" type="number" placeholder="S·ªë l∆∞·ª£ng" required>
    <button type="submit">‚ûï Th√™m</button>
  </form>

  <table>
    <tr>
      <th>ID</th><th>Ti√™u ƒë·ªÅ</th><th>T√°c gi·∫£</th><th>Th·ªÉ lo·∫°i</th><th>S·ªë l∆∞·ª£ng</th><th>C·∫≠p nh·∫≠t</th><th>X√≥a</th>
    </tr>
    {% for b in books %}
    <tr>
      <td>{{ b.id }}</td>
      <td><input id="title_{{ b.id }}" value="{{ b.title }}"></td>
      <td><input id="author_{{ b.id }}" value="{{ b.author }}"></td>
      <td><input id="category_{{ b.id }}" value="{{ b.category }}"></td>
      <td><input id="quantity_{{ b.id }}" type="number" value="{{ b.quantity }}"></td>
      <td><button onclick="updateBook('{{ b.id }}')">üíæ</button></td>
      <td><button onclick="deleteBook('{{ b.id }}')">üóëÔ∏è</button></td>
    </tr>
    {% endfor %}
  </table>

  <script>
  async function addBook(e) {
    e.preventDefault();
    const data = {
      id: parseInt(document.getElementById("id").value),
      title: document.getElementById("title").value,
      author: document.getElementById("author").value,
      category: document.getElementById("category").value,
      quantity: parseInt(document.getElementById("quantity").value)
    };
    await fetch("/books", {method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify(data)});
    location.reload();
  }

  async function updateBook(id) {
    const data = {
      title: document.getElementById(`title_${id}`).value,
      author: document.getElementById(`author_${id}`).value,
      category: document.getElementById(`category_${id}`).value,
      quantity: parseInt(document.getElementById(`quantity_${id}`).value)
    };
    await fetch(`/books/${id}`, {method: "PUT", headers: {"Content-Type": "application/json"}, body: JSON.stringify(data)});
    location.reload();
  }

  async function deleteBook(id) {
    if (confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a s√°ch n√†y?"))
      await fetch(`/books/${id}`, {method: "DELETE"});
    location.reload();
  }
  </script>
</body>
</html>